<div class="flex flex-col h-full w-full overflow-hidden">
  @if (!isFullscreen()) {
    <app-toolbar
      (exportPng)="exportAsPng()"
      (copyLink)="copyLink()"
      (toggleFullscreen)="toggleFullscreen()"
    ></app-toolbar>
  }

  @if (isFullscreen()) {
    <button
      class="fixed top-4 right-4 z-50 w-12 h-12 bg-white/90 hover:bg-white rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:scale-110 cursor-pointer"
      (click)="toggleFullscreen()"
      aria-label="Exit fullscreen"
    >
      <span class="material-icons text-gray-800">close</span>
    </button>
  }

  <div
    #paletteContainer
    class="flex-1 flex flex-col md:flex-row relative min-h-0 overflow-hidden"
  >
    @for (
      item of store.colors();
      track item.id;
      let i = $index;
      let last = $last
    ) {
      <app-color-panel
        [item]="item"
        [draggable]="allowDrag()"
        [style.view-transition-name]="'panel-' + item.id"
        (allowDrag)="allowDrag.set($event)"
        (dragstart)="onDragStart(i)"
        (dragover)="onDragOver($event, i)"
        (drop)="onDrop(i)"
        (dragend)="onDragEnd()"
        (delete)="store.removeColor($event)"
        (lock)="store.toggleLock($event)"
        class="flex-1 min-h-0"
        [class.opacity-50]="draggedIndex() === i"
      ></app-color-panel>
      @if (!last && store.colors().length < 8 && !store.activeShadesPanelId()) {
        <div
          class="hidden md:flex h-0 w-full md:w-0 md:h-full relative z-20 items-center justify-center outline-none group"
        >
          <div
            class="absolute inset-x-0 -top-5 h-10 md:inset-y-0 md:-left-5 md:h-auto md:w-10 bg-transparent z-10"
          ></div>

          <div
            class="w-8 h-8 bg-white rounded-full flex shrink-0 items-center justify-center opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100 group-focus:opacity-100 group-focus:scale-100 transition-all duration-200 shadow-[0_8px_20px_rgba(0,0,0,0.25)] z-20 text-gray-800 hover:text-black hover:scale-110 cursor-pointer"
            (click)="insertColor($index)"
            (keydown.enter)="insertColor($index)"
            (keydown.space)="insertColor($index); $event.stopPropagation()"
            tabindex="0"
            role="button"
            aria-label="Insert intermediate color"
            pTooltip="Add color"
            tooltipPosition="bottom"
          >
            <span class="material-icons">add</span>
          </div>
        </div>
      }
    }
  </div>
</div>
